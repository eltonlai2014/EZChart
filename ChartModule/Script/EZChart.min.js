var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();define("Helper/JQ_AjaxAdaptor",["require","exports","jquery"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r=__importDefault(r);var i=(a.prototype.getDescription=function(){return"[JQ_AjaxAdaptor] "+this.descroption+" "+this.initObj},a.prototype.queryInfoBlob=function(t,e,i){var o;t.URL&&(o=(new Date).getTime(),t.URL=t.URL+"?timestamp="+o),t.type||(t.type=this.initObj.type||a.DEFAULT_METHOD),t.timeout||(t.timeout=this.initObj.timeout||a.DEFAULT_TIMEOUT),a.DEBUG&&console.log(t),r.default.ajax(t.URL,{type:t.type,timeout:t.timeout,cache:!1,data:t.data,xhr:function(){var t=new XMLHttpRequest;return t.onreadystatechange=function(){try{t.responseType="arraybuffer"}catch(t){}},t},success:e,error:i})},a.prototype.queryInfo=function(t,e,i){var o;t.URL&&(o=(new Date).getTime(),t.URL=t.URL+"?timestamp="+o),t.type||(t.type=this.initObj.type||a.DEFAULT_METHOD),t.timeout||(t.timeout=this.initObj.timeout||a.DEFAULT_TIMEOUT),a.DEBUG&&console.log(t),r.default.ajax(t.URL,{type:t.type,timeout:t.timeout,cache:!1,data:t.data,success:e,error:i})},a.DEBUG=!0,a.DEFAULT_METHOD="GET",a.DEFAULT_TIMEOUT=2e4,a);function a(t){this.descroption=t.descroption,this.initObj=t}e.JQ_AjaxAdaptor=i}),define("Helper/BaseChart",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(l.prototype.getParamValue=function(t,e){return void 0===t||null==t?e:t},l.prototype.repaint=function(e,t){e=e||0;var i=this;try{setTimeout(function(){i.drawMain(),i.drawBgToContext(),t instanceof Function&&t("repaint("+e+") finish ")},e)}catch(t){console.log("repaint("+e+") error, "+t.message)}},l.prototype.drawBgToContext=function(t){this.mContext.clearRect(0,0,this.cWidth,this.cHeight),this.mContext.drawImage(this.mBgCanvas,0,0),this.drawFrontContext(t)},l.prototype.MeasureText=function(t,e,i,o){var r=t+":"+e+":"+i+":"+o;if("object"==typeof l.Text_Chche&&l.Text_Chche[r])return l.Text_Chche[r];var a=0;this.mBgContext&&(this.mBgContext.font=o+"pt "+i,a=this.mBgContext.measureText(t).width);var n=document.createElement("MyDIV");n.innerHTML=t,n.style.position="absolute",n.style.top="-100px",n.style.left="-100px",n.style.fontFamily=i,n.style.fontWeight=e,n.style.fontSize=o+"pt",document.body.appendChild(n);a=new h(a,Math.round(n.offsetHeight));return document.body.removeChild(n),l.Text_Chche[r]=a},l.prototype.drawRoundRect=function(t,e,i,o,r,a,n,h,s){void 0===h&&(h=!0),void 0===n&&(n=!1),void 0===a&&(a=5),s=s||1.2,t.save(),t.translate(.5,.5),t.beginPath(),t.moveTo(e+a,i),t.lineTo(e+o-a,i),t.quadraticCurveTo(e+o,i,e+o,i+a),t.lineTo(e+o,i+r-a),t.quadraticCurveTo(e+o,i+r,e+o-a,i+r),t.lineTo(e+a,i+r),t.quadraticCurveTo(e,i+r,e,i+r-a),t.lineTo(e,i+a),t.quadraticCurveTo(e,i,e+a,i),t.lineWidth=s,t.closePath(),h&&t.stroke(),n&&t.fill(),t.restore()},l.prototype.dashedLineTo=function(t,e,i,o,r,a,n){void 0===a&&(a=5),n=n||"#FFFFFF",t.save(),t.translate(.5,.5);var h=o-e,o=r-i,r=Math.floor(Math.sqrt(h*h+o*o)),s=a<=0?r:r/a,m=o/r*a,l=h/r*a;t.beginPath();for(var u=0;u<s;u++)u%2?t.lineTo(Math.round(e+u*l),Math.round(i+u*m)):t.moveTo(Math.round(e+u*l),Math.round(i+u*m));t.strokeStyle=n,t.stroke(),t.restore()},l.prototype.clearLineTo=function(t,e,i,o,r,a,n){n=n||1,a=a||"#000000",t.save(),t.translate(.5,.5),e=Math.round(e),i=Math.round(i),o=Math.round(o),r=Math.round(r),t.beginPath(),t.moveTo(e,i),t.lineTo(o,r),t.lineWidth=n,t.strokeStyle=a,t.stroke(),t.restore()},l.prototype.drawRectEx=function(t,e,i,o,r,a,n){this.clearLineTo(t,e,i,e+o,i,a,n),this.clearLineTo(t,e+o,i,e+o,i+r,a,n),this.clearLineTo(t,e+o,i+r,e,i+r,a,n),this.clearLineTo(t,e,i+r,e,i,a,n)},l.prototype.fillRectEx=function(t,e,i,o,r,a){t.beginPath(),t.rect(e,i,o,r),t.fillStyle=a,t.fill()},l.prototype.drawString=function(t,e,i,o,r,a,n,h,s){n=n||"#000000",s=s||"bottom",h=h||"left",a=a||"Arial",t.save(),t.fillStyle=n,t.font=r+"pt "+a,t.textAlign=h,t.textBaseline=s,r<=8&&(r*=2,i*=2,o*=2,t.font=r+"pt "+a,t.scale(.5,.5)),t.fillText(e,i,o);e=t.measureText(e).width;return t.restore(),e},l.prototype.drawCircle=function(t,e,i,o,r){t.save(),r=r||"#000000",t.beginPath(),t.arc(e,i,o,0,2*Math.PI,!1),t.fillStyle=r,t.fill(),t.restore()},l.prototype.getPrettyAxis=function(t,e,i){null==i&&(i=5);var o=[],r=.05*Math.abs(e-t);t<0?t-=r:0<t&&(t=Math.max(t-r,0)),0<e?e+=r:e<0&&(e=Math.min(e+r,0));for(var a=(e-t)/i,n=-1,h=0,s=0;s<l.Axis_Default.length;s++)if(a<=l.Axis_Default[s]&&(h=Math.floor(t/l.Axis_Default[s]))*l.Axis_Default[s]+l.Axis_Default[s]*(i-1)>=e){n=l.Axis_Default[s];break}if(-1==n)for(var r=Math.round(Math.max(Math.abs(t),Math.abs(e))).toString(),r=Math.pow(10,r.length-1),m=[r,1.2*r,1.5*r,2*r,2.5*r,3*r,4*r,5*r,6*r,7*r,8*r,9*r],h=0,s=0;s<m.length;s++)if(a<=m[s]&&e<(h=Math.floor(t/m[s]))*m[s]+m[s]*(i-1)){n=m[s];break}for(s=h;s<h+i;s++)o.push(s*n);return o},l.prototype.log10=function(t){return Math.log(t)/Math.LN10},l.Text_Chche={},l.Axis_Default=[.1,.2,.25,.5,.8,1,2,3,4,5,6,7,8,9,10,12,15,20,25,30,35,40,45,50,60,70,80,90,100,150,200,250,300,350,400,450,500,800,1e3,1200,1250,1500,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4,12e3,15e3,2e4,25e3,3e4,4e4,5e4,6e4,7e4,8e4,9e4,1e5,12e4,15e4,2e5,25e4,5e5,1e6],l);function l(t){var i=this;this.measureSize=function(){},this.drawFrontContext=function(t){},this.mouseMove=function(t){i.mouseHandle(t)},this.mouseDown=function(t){i.mouseHandle(t)},this.mouseOut=function(t){i.mouseHandle(t)},this.mouseHandle=function(t){},this.getMousePos=function(t){var e=i.mClientRect;return{x:Math.round((t.clientX-e.left)/(e.right-e.left)*i.cWidth),y:Math.round((t.clientY-e.top)/(e.bottom-e.top)*i.cHeight)}},this.hexToRgb=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{}},this.addComma=function(t){t=t.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},this.initObj=t;var e=this.getParamValue(t.ComponentId,"BaseChart");this.mFontType=this.getParamValue(t.FontType,"Arial, sans-serif"),this.mFontSize=this.getParamValue(t.FontSize,26),this.mBgColor=this.getParamValue(t.BgColor,"#FFFFFF"),this.mChartBgColor=this.getParamValue(t.ChartBgColor,"#FFFFFF"),this.mUseClientHeight=this.getParamValue(t.UseClientHeight,!1);t=document.querySelector("#"+e);this.mClientRect=t.getBoundingClientRect(),this.cHeight=this.mClientRect.height,this.cWidth=this.mClientRect.width,this.mUseClientHeight&&(e=document.getElementById(e),this.cHeight=e.clientHeight,this.cWidth=e.clientWidth),this.mCanvas=document.createElement("canvas"),this.mCanvas.width=this.cWidth,this.mCanvas.height=this.cHeight,this.mContext=this.mCanvas.getContext("2d"),this.mBgCanvas=document.createElement("canvas"),this.mBgCanvas.width=this.cWidth,this.mBgCanvas.height=this.cHeight,this.mBgContext=this.mBgCanvas.getContext("2d")}e.BaseChart=i;var h=function(t,e){this.Width=t,this.Height=e};e.TextObj=h;i=function(t,e,i){this.XPos=t,this.YPos=e,this.EventType=i};e.MyMouseEvent=i}),define("Helper/HashMap",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.prototype.put=function(t,e){this.containsKey(t)||this.size++,this.entry[t]=e},o.prototype.get=function(t){return this.containsKey(t)?this.entry[t]:null},o.prototype.remove=function(t){delete this.entry[t]&&this.size--},o.prototype.containsKey=function(t){return t in this.entry},o.prototype.containsValue=function(t){for(var e in this.entry)if(this.entry[e]==t)return!0;return!1},o.prototype.values=function(){var t,e=[];for(t in this.entry)e.push(this.entry[t]);return e},o.prototype.keys=function(){var t,e=[];for(t in this.entry)e.push(t);return e},o.prototype.getSize=function(){return this.size},o.prototype.clear=function(){return this.size=0,this.entry={},this.size},o);function o(){this.size=0,this.entry={}}e.HashMap=i}),define("Helper/index",["require","exports","Helper/JQ_AjaxAdaptor","Helper/BaseChart","Helper/HashMap"],function(t,i,e,o,r){"use strict";function a(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}Object.defineProperty(i,"__esModule",{value:!0}),a(e),a(o),a(r)}),define("StockQuery",["require","exports","Helper/index"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(r.prototype.queryInfo=function(t,e,i){this.aJQ_AjaxAdaptor.queryInfo(t,e,i)},r.prototype.queryInfoBlob=function(t,e,i){this.aJQ_AjaxAdaptor.queryInfoBlob(t,e,i)},r.prototype.queryInfoBlob_Unzip=function(t,e,i){var o=this;this.aJQ_AjaxAdaptor.queryInfoBlob(t,function(t){t=new Uint8Array(t),t=new Zlib.Gunzip(t).decompress(),t=JSON.parse(o.getString(t));e instanceof Function&&e(t)},i)},r.prototype.getString=function(t){for(var e="",i=0,o=t.length;i<o;i++)e+=String.fromCharCode(t[i]);return e=decodeURIComponent(escape(e))},r);function r(t){this.initObj=t,this.aJQ_AjaxAdaptor=new i.JQ_AjaxAdaptor(t)}e.StockQuery=o}),define("StockChart",["require","exports","Helper/index"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,d,o=(i=s.BaseChart,__extends(r,i),r.prototype.bindingEvent=function(){this.mCanvas.addEventListener("mousemove",this.mouseMove,!1)},r.prototype.setData=function(t,e){if(this.mMinRealAmt=999999999,(this.mMaxRealAmt=0)<e.length){for(var i=e[0].MktDate,o=0;o<t.length;o++)if(t[o].MktDate==i){t=t.slice(o);break}for(var r=new s.HashMap,o=0,a=e.length;o<a;o++)r.put(e[o].MktDate,e[o]);for(var n=0,o=0;o<t.length;o++){var h=r.get(t[o].MktDate);h?(n+=h.Shares,t[o].SumShares=n,t[o].SumAmt=h.Amt,0<o&&(t[o].SumAmt+=t[o-1].SumAmt)):(t[o].SumShares=t[o-1].SumShares,t[o].SumAmt=t[o-1].SumAmt),t[o].RealAmt=t[o].SumShares*t[o].CP,this.mMaxRealAmt=Math.max(this.mMaxRealAmt,t[o].RealAmt),this.mMinRealAmt=Math.min(this.mMinRealAmt,t[o].RealAmt)}}this.calMaxMin(),this.mChartData=t},r.prototype.getInvResult=function(){var t={};return 0<this.mChartData.length&&(t.SumShares=this.mChartData[this.mChartData.length-1].SumShares,t.SumAmt=this.mChartData[this.mChartData.length-1].SumAmt,t.RealAmt=this.mChartData[this.mChartData.length-1].RealAmt),t},r.prototype.drawChartArea=function(){this.drawAxis();var t=this.mChartData;console.log(t),this.mChartRectWidth=this.mChartWidth/(t.length+1),this.drawChartWithCircle(t,d.INV_CHART,this.mInvColor,1.5),this.drawChart(t,d.REAL_CHART,this.mRealColor,2)},r.prototype.drawAxis=function(){var t="right";this.fillRectEx(this.mBgContext,0,0,this.cWidth,this.cHeight,this.mBgColor),this.fillRectEx(this.mBgContext,this.mAxisWidth,this.mTopHeight,this.mChartWidth,this.mChartHeight,this.mChartBgColor),this.mShowChartBorder&&this.drawRectEx(this.mBgContext,this.mAxisWidth,this.mTopHeight,this.mChartWidth,this.mChartHeight,"111111",1);var e=this.MeasureText(this.mTitleLabel,"normal",this.mTitleFont,this.mTitleFontSize);this.drawString(this.mBgContext,this.mTitleLabel,this.cWidth/2+e.Width/2,this.mTopHeight/2+e.Height/2,this.mTitleFontSize,this.mTitleFont,this.mAxisColor,t);for(var i=0;i<this.mAxisAmount;i++){var o=this.mChartHeight/(this.mAxisAmount+1)*(this.mAxisAmount-i)+this.mTopHeight;this.dashedLineTo(this.mBgContext,this.mAxisWidth,o,this.mChartWidth+this.mAxisWidth,o,3,this.mAxisColor),this.drawString(this.mBgContext,this.mPrettyAxis[i+1]+"",this.mAxisWidth-4,Math.round(o+this.mAxisHeight/2),this.mAxisFontSize,this.mAxisFont,this.mAxisColor,t)}e=this.mChartHeight+this.mTopHeight+this.mAxisHeight/2;this.drawString(this.mBgContext,this.mPrettyAxis[0]+"",this.mAxisWidth-4,Math.round(e),this.mAxisFontSize,this.mAxisFont,this.mAxisColor,t),e=this.mTopHeight+this.mAxisHeight/2,this.drawString(this.mBgContext,this.mPrettyAxis[this.mPrettyAxis.length-1]+"",this.mAxisWidth-4,Math.round(e),this.mAxisFontSize,this.mAxisFont,this.mAxisColor,t)},r.prototype.drawChart=function(t,e,i,o){o=o||1.5,this.mBgContext.save(),this.mBgContext.translate(.5,.5),this.mBgContext.lineWidth=o,this.mBgContext.beginPath();for(var r=0;r<t.length;r++){var a=t[r],n=this.mChartRectWidth*(r+1)+this.mAxisWidth,a=this.getYPosByType(a,e);this.mBgContext.lineTo(n,a)}this.mBgContext.strokeStyle=i,this.mBgContext.lineJoin="round",this.mBgContext.stroke(),this.mBgContext.restore()},r.prototype.drawChartWithCircle=function(t,e,i,o){o=o||1.5,this.mBgContext.save(),this.mBgContext.translate(.5,.5),this.mBgContext.lineWidth=o,this.mBgContext.beginPath();for(var r=0;r<t.length;r++){var a=t[r],n=this.mChartRectWidth*(r+1)+this.mAxisWidth,h=this.getYPosByType(a,e);this.mBgContext.lineTo(n,h)}if(this.mBgContext.strokeStyle=i,this.mBgContext.lineJoin="round",this.mBgContext.stroke(),this.mBgContext.restore(),t.length<50)for(r=0;r<t.length;r++){a=t[r],n=this.mChartRectWidth*(r+1)+this.mAxisWidth,h=this.getYPosByType(a,e);this.drawCircle(this.mBgContext,n,h,3,i)}},r.prototype.getYPosByType=function(t,e){switch(e){case d.INV_CHART:return this.mTopHeight+this.mChartHeight*(this.mMaxRealAmt-t.SumAmt)/(this.mMaxRealAmt-this.mMinRealAmt);case d.REAL_CHART:return this.mTopHeight+this.mChartHeight*(this.mMaxRealAmt-t.RealAmt)/(this.mMaxRealAmt-this.mMinRealAmt);default:return 0}},r.prototype.calMaxMin=function(){this.mPrettyAxis=this.getPrettyAxis(this.mMinRealAmt,this.mMaxRealAmt,this.mAxisAmount+2),this.mMaxRealAmt=Math.max(this.mMaxRealAmt,this.mPrettyAxis[this.mPrettyAxis.length-1]),this.mMinRealAmt=Math.min(this.mMinRealAmt,this.mPrettyAxis[0]);var t=this.MeasureText(this.mPrettyAxis[this.mPrettyAxis.length-1]+"00","normal",this.mAxisFont,this.mAxisFontSize);this.mAxisWidth=t.Width,this.mChartWidth=this.cWidth-this.mAxisWidth-this.mBorderWidth},r.prototype.drawMain=function(){this.drawChartArea()},r);function r(t){var u=i.call(this,t)||this;u.mChartData={},u.mChartRectWidth=0,u.mMaxRealAmt=0,u.mMinRealAmt=0,u.mPrettyAxis=[],u.mouseHandle=function(t){var e=u.getMousePos(t),t=new s.MyMouseEvent(e.x,e.y,t.type);u.drawBgToContext(t)},u.drawFrontContext=function(t){var e,i,o,r,a,n,h,s,m,l;t&&0!=u.mChartRectWidth&&u.mChartData&&(m=Math.max(t.XPos,u.mAxisWidth),m=Math.min(t.XPos,u.mAxisWidth+u.mChartWidth),m=Math.max(t.XPos,u.mAxisWidth),e=-1,(0<u.mChartRectWidth||m<u.mAxisWidth||m>u.mAxisWidth+u.mChartRectWidth)&&(e=Math.round((m-u.mAxisWidth-u.mChartRectWidth)/u.mChartRectWidth)),0<=e&&e<u.mChartData.length&&(i=Math.round(u.mAxisWidth+(e+1)*u.mChartRectWidth),u.mShowQuoteLine&&(o=u.mChartData[e],s=u.hexToRgb(u.mRealColor),l=u.getYPosByType(o,d.REAL_CHART),u.drawCircle(u.mContext,i,l,5,"rgba("+s.r+","+s.g+","+s.b+",0.7)"),s=u.hexToRgb(u.mInvColor),l=u.getYPosByType(o,d.INV_CHART),u.drawCircle(u.mContext,i,l,5,"rgba("+s.r+","+s.g+","+s.b+",0.7)")),r=60,a="#000000",n="#FFFFFF",h=.7,(m=i+(t=20))+(o=150)>u.mAxisWidth+u.mChartWidth-t&&(m=i-t-o),t=u.mTopHeight+u.mChartHeight/2+t,u.mContext.strokeStyle=a,s=u.hexToRgb(n),u.mContext.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+h+")",u.drawRoundRect(u.mContext,m,t,o,r,7,!0),m=[Math.round(m+6),Math.round(m+20),Math.round(m+52)],l=Math.round(t+r/6+u.mAxisHeight/2),u.drawString(u.mContext,u.mChartData[e].MktDate,m[1],l,u.mAxisFontSize,u.mAxisFont,"#000000","left"),l=Math.round(t+5*r/6+u.mAxisHeight/2),u.drawCircle(u.mContext,m[0]+4,Math.round(t+5*r/6),5,u.mInvColor),u.drawString(u.mContext,"成本 ",m[1],l,u.mAxisFontSize,u.mAxisFont,"#000000","left"),u.drawString(u.mContext,u.addComma(u.mChartData[e].SumAmt.toFixed(2)),m[2],l,u.mAxisFontSize,u.mAxisFont,"#000000","left"),l=Math.round(t+3*r/6+u.mAxisHeight/2),u.drawCircle(u.mContext,m[0]+4,Math.round(t+3*r/6),5,u.mRealColor),u.drawString(u.mContext,"市值 ",m[1],l,u.mAxisFontSize,u.mAxisFont,"#000000","left"),u.drawString(u.mContext,u.addComma(u.mChartData[e].RealAmt.toFixed(2)),m[2],l,u.mAxisFontSize,u.mAxisFont,"#000000","left")))};var e=u.getParamValue(t.ComponentId,"");u.mBorderWidth=u.getParamValue(t.BorderWidth,14),u.mTopHeight=u.getParamValue(t.TopHeight,14),u.mBottomHeight=u.getParamValue(t.BottomHeight,14),u.mAxisFont=u.getParamValue(t.AxisFont,u.mFontType),u.mAxisFontSize=u.getParamValue(t.AxisFontSize,9),u.mAxisWidth=u.getParamValue(t.AxisWidth,59),u.mAxisAmount=u.getParamValue(t.AxisAmount,5),u.mAxisAmount=u.getParamValue(t.AxisAmount,5),u.mAxisColor=u.getParamValue(t.AxisColor,"#111111"),u.mTitleFont=u.getParamValue(t.TitleFont,u.mFontType),u.mTitleFontSize=u.getParamValue(t.TitleFontSize,9),u.mTitleLabel=u.getParamValue(t.TitleLabel,""),u.mShowChartBorder=u.getParamValue(t.ShowChartBorder,!1),u.mShowQuoteLine=u.getParamValue(t.ShowQuoteLine,!0),u.mQuoteLineColor=u.getParamValue(t.QuoteLineColor,"#111111"),u.mInvColor=u.getParamValue(t.InvColor,"#0000FF"),u.mRealColor=u.getParamValue(t.RealColor,"#FF0000"),document.querySelector("#"+e).appendChild(u.mCanvas),console.log(u.mClientRect);e=u.MeasureText("00000000","normal",u.mAxisFont,u.mAxisFontSize);return u.mAxisWidth=e.Width,u.mAxisHeight=e.Height,u.mChartHeight=u.cHeight-u.mTopHeight-u.mBottomHeight,u.mChartWidth=u.cWidth-u.mAxisWidth-u.mBorderWidth,u.getParamValue(t.PaintOnCreate,!1)&&u.repaint(),u.bindingEvent(),u}e.StockChart=o,(o=d=d||{})[o.INV_CHART=1]="INV_CHART",o[o.REAL_CHART=2]="REAL_CHART"});